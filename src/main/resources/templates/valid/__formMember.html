<!DOCTYPE html>

<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"

      layout:decorate="~{layout}"
>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <title>Add New Member</title>
</head>
<body>
<div layout:fragment="content">
    <div class="container p-2">
        <div class="card ">
            <div class="row mt-4 ">
                <div class="col-md-6 offset-1">
                    <div class="container">
                        <h2>Nouvel adhérent </h2>
                        <form class="form-horizontal" method="post" action="uploadFile" th:action="@{/saveMember}"
                              enctype="multipart/form-data">
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="lastName">Nom :</label>
                                <div class="col-sm-8">
                                    <input type="text" placeholder="Entrer Nom" name="lastName" id="lastName"
                                           class="form-control"
                                           th:value="${member.lastName}">
                                    <span class="text-danger" th:errors="${member.lastName}"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="firstName">Prénom :</label>
                                <div class="col-sm-8">
                                    <input type="text" placeholder="Entrer Prénom" name="firstName" id="firstName"
                                           class="form-control" th:value="${member.firstName}">
                                    <span class="text-danger" th:errors="${member.firstName}"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="email">Email :</label>
                                <div class="col-sm-8">
                                    <input type="email" placeholder="Entrer Email" name="email" id="email"
                                           class="form-control"
                                           th:value="${member.email}">
                                    <span class="text-danger" th:errors="${member.email}"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="cine">CINE :</label>
                                <div class="col-sm-8">
                                    <input type="text" placeholder="Entrer CINE" name="cine" id="cine"
                                           class="form-control"
                                           th:value="${member.cine}">
                                    <span class="text-danger" th:errors="${member.cine}"></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-2" for="subscriptionDate">Date d'inscription
                                    :</label>
                                <div class="col-sm-8">
                                    <input type="date" name="subscriptionDate" id="subscriptionDate"
                                           class="form-control"
                                           th:value="${member.subscriptionDate}">
                                    <span class="text-danger" th:errors="${member.subscriptionDate}"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="payementDate">Date de payement :</label>
                                <div class="col-sm-8">
                                    <input type="date" name="payementDate" id="payementDate" class="form-control"
                                           th:value="${member.payementDate}">
                                    <span class="text-danger" th:errors="${member.payementDate}"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="cine">Téléphone :</label>
                                <div class="col-sm-8">
                                    <input type="text" placeholder="Entrer N° Téléphone" name="phone" id="phone"
                                           class="form-control" th:value="${member.phone}">
                                    <span class="text-danger" th:errors="${member.phone}"></span>
                                </div>
                            </div>


                            <div class="form-group">
                                <label class="control-label col-sm-2">Genre :</label>
                                <div class="col-sm-8">
                                    <div class="d-flex">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="gridRadios"
                                                   id="gridRadios1" th:field="${member.gender}" value="Male" checked>

                                            <label class="form-check-label" for="gridRadios1">
                                                Home &nbsp;
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="gridRadios"
                                                   id="gridRadios2" th:field="${member.gender}" value="Female">
                                            <label class="form-check-label" for="gridRadios2">
                                                Femme
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-sm-10 offset-sm-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="gridCheck1" name="is_Active"
                                               th:field="${member.is_Active}">
                                        <label class="form-check-label" for="gridCheck1">
                                            Payé
                                        </label>
                                    </div>
                                </div>
                            </div>


                            <div class="form-group">
                                <div class="card mb-1 offset-2" style="max-width: 540px;">
                                    <div class="row g-0 ">
                                        <div class="col-md-8">

                                            <div class="card-body">
                                                <label for="fileImage">Image Profile</label>

                                                <input type="file" name="photo" id="fileImage" class="form-control" accept="image/jpeg, image/png">

                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="image-preview" id="imagePreview">
                                                <img src="" class="img-fluid" alt="No image found!">
                                                <span class="image-preview__default-text">Image Preview</span>
                                            </div>
                                        </div>

                                        <div class="col-md-4">
                                        <button type="button" id="start-camera">Start Camera</button>
                                        <video id="video" width="200" height="200" autoplay></video>
                                        <button type="button" id="click-photo">Click Photo</button>
                                        <canvas id="canvas"  width="200" height="200" ></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-auto">
                                    <button type="submit" class="btn btn-success">Enregistrer</button>
                                </div>
                            </div>
                        </form>
                            <script>
                                const inpFile = document.getElementById("fileImage");
                                const previewContainer = document.getElementById("imagePreview");
                                const previewImage = previewContainer.querySelector(".img-fluid");
                                const previewDefaultText = previewContainer.querySelector(".image-preview__default-text")

                                inpFile.addEventListener("change", function () {
                                    const file = this.files[0];
                                    console.log(file);

                                    if (file) {
                                        const reader = new FileReader();
                                        previewDefaultText.style.display = "none";
                                        previewImage.style.display = "block";
                                        reader.addEventListener("load", function () {
                                            console.log(this);
                                            previewImage.setAttribute("src", this.result);
                                        });
                                        reader.readAsDataURL(file);

                                    } else {
                                        previewImage.style.display = null;
                                        previewDefaultText.style.display = null;
                                    }
                                })

                                //_________________________snapshot_______________________


                                let camera_button = document.querySelector("#start-camera");
                                let video = document.querySelector("#video");
                                let click_button = document.querySelector("#click-photo");
                                let canvas = document.querySelector("#canvas");

                                camera_button.addEventListener('click', async function() {
                                    let stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                                    video.srcObject = stream;
                                });

                                click_button.addEventListener('click', function() {
                                    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
                                    let image_data_url = canvas.toDataURL('image/jpeg');
                                    // data url of the image
                                    console.log(image_data_url);


                                    /*// save to URL
                                   canvas.toBlob(
                                       blob => {
                                           const anchor = document.getElementById('download-link');
                                           anchor.href = URL.createObjectURL(blob);
                                       },
                                       'image/jpeg',
                                       0.9,
                                   );*/
                                    canvas.toBlob(
                                        blob => {
                                            const anchor = document.createElement('a');
                                            anchor.download = 'Photo_'+new Date().toISOString().slice(0, 22)+'.png'; // optional, but you can give the file a name
                                            anchor.href = URL.createObjectURL(blob);
                                            anchor.click(); // ✨ magic!
                                           let tata= URL.revokeObjectURL(anchor.href); // remove it from memory and save on memory! 😎

                                        },
                                        'image/png',
                                        1,
                                    )




                                });
                            </script>

                            <style>
                                .image-preview {
                                    width: 150px;
                                    min-height: 100px;
                                    border: 2px solid #dddddd;
                                    margin: 5px;
                                    /* Default text */
                                    display: flex;
                                    justify-content: center;
                                    align-items: center;
                                }

                                .img-fluid {
                                    display: none;
                                    width: 100%;
                                }
                                video {
                                    width: 150px;
                                    height: 150px;
                                    object-fit: cover;
                                    border-radius: 50%;
                                }
                            </style>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

</body>
</html>